# ContextCore Mimir Alert Rules
# Convention: ContextCore[Resource][Issue]
# See: docs/semantic-conventions.md (Alert Naming Convention)

groups:
  - name: contextcore_mimir_alerts
    rules:
      - alert: ContextCoreInsightLatencyHigh
        expr: |
          histogram_quantile(0.99,
            sum(rate(contextcore_insight_query_duration_milliseconds_bucket[5m])) by (le)
          ) > 500
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "Insight query latency > 500ms P99"
          description: "Agent insight queries are exceeding the 500ms P99 latency budget."
          runbook_url: "docs/OPERATIONAL_RUNBOOK.md#insight-latency"

      - alert: ContextCoreTaskStalled
        expr: |
          max_over_time(project_task:contextcore_task_progress:rate1h[24h]) == 0
        for: 1h
        labels:
          severity: warning
        annotations:
          summary: "Task stalled > 24h"
          description: "Task progress has not changed for at least 24 hours."
          runbook_url: "docs/OPERATIONAL_RUNBOOK.md#task-stalled"
